# Desktop-приложение "ТильдаКод"

Это десктопное приложение для взаимодействия с базой данных портала.

## Создание установочного файла (.msi)

Для распространения приложения можно создать установочный файл `.msi` с помощью `cx_Freeze`.

1.  **Установите `cx_Freeze`**:
    В вашем активированном виртуальном окружении выполните:
    ```bash
    pip install cx_freeze
    ```

2.  **Создайте файл `setup.py`**:
    В корневой папке `desktop-app` (рядом с `.venv`, `src` и `keys`) создайте файл с именем `setup.py` и следующим содержимым:

    ```python
    # setup.py
    import sys
    from cx_Freeze import setup, Executable

    # Зависимости, которые нужно явно включить в сборку
    build_exe_options = {
        "packages": ["os", "tkinter", "psycopg2", "dotenv", "idna"],
        "includes": ["tkinter.ttk"],
        "include_files": [
            "keys/"  # Включаем папку с ключами
        ],
    }

    # Базовые настройки для исполняемого файла
    base = None
    if sys.platform == "win32":
        base = "Win32GUI"  # Скрывает окно консоли при запуске

    setup(
        name="TildaKod",
        version="1.0",
        description="Desktop client for portal",
        options={"build_exe": build_exe_options},
        executables=[Executable("src/main_window.py", base=base, target_name="TildaKodApp.exe")]
    )
    ```

3.  **Запустите сборку**:
    В терминале, находясь в папке `desktop-app`, выполните команду:
    ```bash
    python setup.py bdist_msi
    ```
    После завершения процесса в папке `desktop-app/build/` появится подпапка (например, `exe.win-amd64-3.11`), внутри которой вы найдете готовый `.msi` файл.

---

## Инструкция по развертыванию на новом ПК

Для корректной работы приложения на новом компьютере под управлением Windows необходимо выполнить следующие шаги после установки.

### Требования

*   Операционная система Windows 10 или Windows 11.
*   Установочный файл приложения (`.msi`).

### Шаги установки и настройки

1.  **Установка приложения**
    *   Запустите установочный файл `.msi` и следуйте инструкциям мастера установки.

2.  **Проверка наличия OpenSSH-клиента**
    *   Приложение использует системный SSH-клиент для подключения к базе данных. Убедитесь, что он установлен.
    *   Откройте **Параметры** -> **Приложения** -> **Дополнительные компоненты**.
    *   В списке установленных компонентов найдите **"OpenSSH-клиент"**.
    *   Если его нет, нажмите **"Добавить компонент"** и установите его.

3.  **Копирование конфигурационных файлов**
    *   Найдите папку, куда было установлено приложение (например, `C:\Program Files (x86)\TildaKod\`).
    *   Скопируйте в эту папку следующие файлы и папки из вашего проекта:
        *   Файл `.env`
        *   Папку `keys` (вместе с файлом `id_ed25519` внутри). *Примечание: если вы следовали инструкции по созданию `.msi` выше, эта папка уже должна быть включена в установщик.*
    *   В итоге структура в папке установки должна выглядеть так:
        ```
        C:\Program Files (x86)\TildaKod\
        ├── main_window.exe  (или другое имя исполняемого файла)
        ├── .env
        └── keys/
            └── id_ed25519
        ```

4.  **Настройка прав доступа к SSH-ключу (Обязательно!)**
    *   Это самый важный шаг. Без него SSH-клиент откажется использовать ключ.
    *   Найдите файл ключа `id_ed25519` в папке установки (например, `C:\Program Files (x86)\TildaKod\keys\id_ed25519`).
    *   Нажмите на него правой кнопкой мыши -> **Свойства**.
    *   Перейдите на вкладку **Безопасность** и нажмите **Дополнительно**.
    *   Нажмите **Отключить наследование** и в появившемся окне выберите **"Преобразовать унаследованные разрешения в явные..."**.
    *   Выделите и **удалите** все учетные записи из списка, кроме **вашей текущей учетной записи** и `SYSTEM`.
    *   Нажмите **Применить** и **ОК**.

После выполнения всех этих шагов приложение готово к работе и сможет успешно подключаться к удаленной базе данных.

---
### Для разработки

Активация виртуального окружения:
```powershell
.\.venv\Scripts\Activate.ps1
```
